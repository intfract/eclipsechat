<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<% if (is_desktop) { %>
<html>
  <head>
  <title>Home - Eclipse</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
 <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Urbanist:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<style>
  *,
*::before,
*::after {
  box-sizing: border-box;
}

html, body {
  overflow: hidden;
}

body {
  width: 100vw;
height: 100vh;
  background-color: #f5f5f5;
  margin:0px;
  padding:0px;
}

.app {
  display:flex;
  flex-direction:row;
  gap:20px;
  width:100%;
  height:100%;
  justify-content:Center;
  align-items:center;
}

.left-row {
  width: 25vw;
height: 93vh;
flex-shrink: 0;
  border-radius: 7.5px;
background: #EFE4F8;
  padding:25px;
  display:flex;
  flex-direction:column;
}

.messages {
    width: 69%;
height: 93vh;
flex-shrink: 0;
  border-radius: 7.5px;
background: #fff;
  padding:25px;
  display:flex;
  flex-direction:column;
}

h1 {
  color: #8755AB;
font-family: Urbanist;
font-size: 24px;
font-style: normal;
font-weight: 700;
line-height: normal;
  width:100%;
  height:auto;
}

input::placeholder {
  color:#B38DCF;
}

.contacts > input {
  flex-shrink: 0;
  width:100%;
  height:40px;
  border-radius: 5px;
border: 1px solid #B38DCF;
  background:none;
}

.contacts > input {
left: 15px;
top: 12px;
  color: #B38DCF;
font-family: Urbanist;
font-size: 13px;
font-style: normal;
font-weight: 400;
line-height: normal;
  padding:15px;
}

.contacts > input:focus {
  outline: 2px solid #B38DCF; 
}

.contacts {
  display: inline-flex;
  width:100%;
flex-direction: column;
align-items: flex-start;
gap: 20px;
flex-shrink: 0;
}

.contact {
  display:flex;
  flex-direction:row;
  gap:10px;
}

.info {
  display:flex;
  flex-direction:column;
  gap:0;
  justify-content:center;
}

.info > h4 {
  color: #B38DCF;
font-family: Inter;
font-size: 13px;
font-style: normal;
font-weight: 600;
line-height: normal;
 margin:0;
}

.info > h2 {
  color: #000;
font-family: Inter;
font-size: 20px;
font-style: 800;
font-weight: 600;
line-height: normal;
 margin:0;
}

.info > p {
  color: #B38DCF;
font-family: Inter;
font-size: 10px;
font-style: normal;
font-weight: 300;
line-height: normal;
 margin-top:5px;
}

.messages > * {
  margin:10px;
}

.msg-list {
  display: flex;
width: 100%;
flex:1;
  flex-shrink:0;
  overflow-y:scroll;
flex-direction: column;
align-items: center;
gap: 20px;
flex-shrink: 0;
}

.incoming {
  display: flex;
flex-direction: column;
align-items: flex-start;
gap: 10px;
align-self: stretch;
}

.outgoing {
  display: flex;
flex-direction: column;
align-items: flex-end;
gap: 10px;
align-self: stretch;
}

.incoming > .bubble {
  font-family:Inter;
display: flex;
padding: 15px;
flex-direction: column;
align-items: flex-start;
gap: 10px;
border-radius: 20px 20px 20px 0px;
background: #EFEFEF;
  
  color: #424242;
font-family: Inter;
font-size: 15px;
font-style: normal;
font-weight: 300;
line-height: normal;
}

.outgoing > .bubble {
  display: flex;
padding: 15px;
flex-direction: column;
align-items: flex-start;
gap: 10px;
  
border-radius: 20px 20px 0px 20px;
background: rgba(181, 96, 246, 0.10);
  
   color: #424242;
font-family: Inter;
font-size: 15px;
font-style: normal;
font-weight: 300;
line-height: normal;
}

.messages > .msg-input {
  border-radius: 9.75px;
border: 2px solid #F6F6F6;
background: #FFF;
  display: inline-flex;
padding: 15px 14px 14px 14px;
justify-content: center;
align-items: center;
  width:100%;
}
  
  .messages > p {
    font-family: Inter;
  }

.messages > .msg-input > input {
  background:none;
  outline:none;
  border:none;
  width:100%;
}
  
  .settings {
    font-family:Inter;
    display:flex;
    flex-direction:row;
    align-items:center;
    gap:10px;
   justify-content:center;
    color:#000;
  }
  
  .settings > a {
    text-decoration:none;
  }
  
  .settings > * {
     color:#000;
    gap:15px;
    display:flex;
    flex-direction:row;
    align-items:center;
  }

.messages > .msg-input > button {
  border:0;
  background:none;
  
}

i {
  font-family: "Material Symbols Outlined";
  font-style:normal;
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 24;
  font-size:16px;
}
  
  i.filled {
    font-variation-settings:
  'FILL' 1,
  'wght' 400,
  'GRAD' 0,
  'opsz' 24;
  font-size:16px;
  }

.contact:hover {
  cursor:pointer;
  opacity:0.75;
}

#typing {
  display:none;
}
  </style>
</head>
<body>
  <div class="app">
    <div class="left-row">
      <img src="https://i.ibb.co/rbrqvWg/output-onlinepngtools-1.png" width="100">
      <h1>Welcome, <%= me.nickname %></h1>
        <div class="contacts">
      <input placeholder = "Add a user..." id="addUser">  
          <% me.contacts.forEach(contact => { %>
          <div class="contact" onclick="window.location.assign('/messages/<%= contact.username %>')">
            <img src="<%= contact.avatar %>" width="36" height="36" style="border-radius:50px;">
            <div class="info">
              <h4><%= contact.username %></h4>
                <p>(coming soon)</p>
            </div>
          </div>
            <% }); %>
              <div class="settings">
                <a href="/users/<%= me.username %>"><img width="32" height="32" src="<%= me.avatar %>" style="border-radius:50px;"> <%= me.username %></a> <a href="/settings"><i class="filled">settings</i></a>
              </div>
          
        </div>
    </div>
    <div class="messages">
      <h1>Pick a user on the sidebar to start chatting!</h1>
      <p>Eclipse was made for simplicity. If you wanna add a user, get there username and add them with the "Pick a user" input. If you want to talk to your existing contacts, click them on the sidebar!</p>
    </div>
  </div>
            <script>
              

function addUser(me, user) {
  console.log(user + 'hi')
  fetch('/user/' + me + '/addContact/' + user).then(res => res.json()).then(response => {
    if (response.error) {
      alert('something wen\'t wrong. try again later.')
    } else {
      window.location.assign('/messages/' + user)
    }
  })
}


const contactInput = document.querySelector('#addUser')

contactInput.addEventListener("keydown", e => enterEvent(e))

function enterEvent(event){
    if (event.keyCode == 13) {
     addUser('<%= me.username %>', event.target.value) 
    }
}
            </script>
</body>
</html>
          <% } else { %>
  <html>
  <head> 
    <style>
           @import "https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css";

@import url("https://capnkitten.github.io/BetterDiscord/Themes/Material-Discord/css/fonts/google-sans.css");

* {
  font-family: "Google Sans";
}

body {
  min-height: 100vh;
  min-height: -webkit-fill-available;
}

html,body {
  overflow-x: hidden;
  max-width:100vw;
}

html {
  height: -webkit-fill-available;
}
 
body,html {
  background-color: #1f1f1f;
}

main {
  height: 100vh;
  height: -webkit-fill-available;
  max-height: 100vh;
  overflow-x: auto;
  overflow-y: hidden;
}

.dropdown-toggle { outline: 0; }

.btn-toggle {
  padding: .25rem .5rem;
  font-weight: 600;
  color: var(--bs-emphasis-color);
  background-color: transparent;
}
.btn-toggle:hover,
.btn-toggle:focus {
  color: rgba(var(--bs-emphasis-color-rgb), .85);
  background-color: var(--bs-tertiary-bg);
}

.btn-toggle::before {
  width: 1.25em;
  line-height: 0;
  content: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='rgba%280,0,0,.5%29' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 14l6-6-6-6'/%3e%3c/svg%3e");
  transition: transform .35s ease;
  transform-origin: .5em 50%;
}

[data-bs-theme="dark"] .btn-toggle::before {
  content: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='rgba%28255,255,255,.5%29' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 14l6-6-6-6'/%3e%3c/svg%3e");
}

.btn-toggle[aria-expanded="true"] {
  color: rgba(var(--bs-emphasis-color-rgb), .85);
}
.btn-toggle[aria-expanded="true"]::before {
  transform: rotate(90deg);
}

.btn-toggle-nav a {
  padding: .1875rem .5rem;
  margin-top: .125rem;
  margin-left: 1.25rem;
}
.btn-toggle-nav a:hover,
.btn-toggle-nav a:focus {
  background-color: var(--bs-tertiary-bg);
}

.scrollarea {
  overflow-y: auto;
}


.activee:focus {
    color:#000;
}

i {
  text-decoration:none;
  font-style:normal;
  font-family: "Material Symbols Rounded";
}
 
i.filled {
  font-variation-settings:
  'FILL' 1,
  'wght' 600,
  'GRAD' 200,
  'opsz' 48
}

.nav-link {
  gap:10px;
  display:Flex;
  align-items:center;
}

.activee {
  background-color: #EAC9FF;
  color:#000;
}

.nav-link:hover {
  background-color: #6f42c1;
    color:#FFF;
}

.nav-pills {
  gap:5px;
}

.friendlist > .nav-item > .nav-link {
  border-radius:20px;
}

.friendlist > .nav-item > .nav-link > .column > .frecon {
  font-size:13px;
}

.friendlist > .nav-item > .nav-link > .column > .col {
  display:flex;
  align-items:flex-end;
  gap:10px;
}

.frecon {
  padding-top:7px;
}

.friendlist > .nav-item > .nav-link {
  background-color: #1f1f1f;
  color:#fff;
}

.friendlist > .nav-item > .activee {
  background-color: #6f42c1; 
  color: #fff;
}

.friendlist > .nav-item > .nav-link:hover {
  background-color: #6f42c1; 
  color: #fff;
}


/* Define a transition duration during page visits */
html.is-changing .transition-fade {
  transition: opacity 0.25s;
  opacity: 1;
}
/* Define the styles for the unloaded pages */
html.is-animating .transition-fade {
  opacity: 0;
}

div.snb {
    display:none;
}

.btn {
  border-radius:50px;
}

input {
 width: 100%;
  border-radius:15px;
  border:1px white solid;
  padding:8px;
}

form {
  display:flex;
  gap:10px;
  padding:3px;
  z-index:999;
  
    align-items: center;
    justify-content: space-between;
    display: flex;
}

input:focus {
  outline:none;
}

.chatbox {
  height: 83vh;
}

.card {
  border-radius:25px;
  height:min-content;
}


.incoming, .outgoing {
  display:flex;
}

.chatbox {
  display:flex;
  flex-direction:column;
  gap:10px;
  width:100%;
  
  max-width:100%;
}

.chatbox > .col {
  max-width:100%;
}

.incoming, .outgoing  {
  justify-content: start;
  max-width:100%;
  width:auto;
}

.outgoing {
  justify-content: end;
}

.outgoing > .card {
  text-align:right;
}

.monkey-color {
  background-color: #2f2f2f;
}

.padding {
  padding:10px;
}

.user {
  display:flex;
  align-items:center;
  flex-direction:row;
}
 
           </style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  </head> 
  <body>  
    <!-- Vertically centered modal -->
<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Create a new chat with a user!</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input placeholder="Enter username.." id="usr">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="addUser('<%= me.username %>', document.getElementById('usr').value)" data-bs-dismiss="modal">Add</button>
      </div>
    </div>
  </div>
</div>
</div>
     <div class="d-flex row g-0 text-left justify-content-start ">
    <div class="d-flex flex-column flex-shrink-0 p-3 text-light bg-black border-end navbar-expand-sm" style="width: min-content;height:100vh;justify-content:center;">
    <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none" style="display:flex;justify-content:center;align-items:center;width:100%;">
     <img src="https://i.ibb.co/TWYNMVT/image.png" width="32" alt="LOGO"> 
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
      <li class="nav-item">
        <a href="#" class="nav-link text-white" aria-current="page">
          <i class="filled">home</i> 
        </a>
      </li>
      <li>
        <a href="/servers" class="nav-link text-white">
         <i class="filled">groups</i>
        </a>
      </li>
      <li>
        <a href="#" class="nav-link text-white">
         <i>code</i>
        </a>
      </li>
      <li>
        <a href="#" class="nav-link text-white">
          <i class="filled">info</i>
        </a>
      </li>
    </ul>
    <hr>
    <div class="dropdown" style="width:100%;display:flex;align-items:center;justify-content:center;">
      <a href="#" class="d-flex align-items-center text-white text-decoration-none " data-bs-toggle="dropdown" aria-expanded="false" style="display:flex;align-items:center;justify-content:center;">
        <img src="<%= me.avatar %>" alt="" width="32" height="32" class="rounded-circle me-2">
      </a>
      <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
        <li><a class="dropdown-item" href="#">Profile</a></li>
        <li><a class="dropdown-item" href="/settings">Settings</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="/logout">Sign out</a></li>
      </ul>
    </div>
  </div>
    <div class="d-flex flex-column col flex-shrink-0 p-3 text-light navbar-expand-sm bg-black" style="height:100vh;width:70%;overflow-y:scroll;overflow-x:hidden;">
      <div class="row" style="padding:5px; display:flex; "><h4 class="col">Direct Messages</h4><a class="d-flex align-items-center justify-content-center btn text-light bg-dark col" href="#" style="display:flex;width:min-content;" data-bs-toggle="modal" data-bs-target="#myModal"><i>add</i></a></div><br>
    <ul class="nav nav-pills friendlist flex-column mb-auto">
      <% me.contacts.forEach(contact => { %>
     
      <li class="nav-item" style="max-width:100%;">
        <a href="/messages/<%= contact.username %>" class="nav-link" aria-current="page" style="max-width:100%;">
          <div class="column" style="max-width:100%;">
            <div class="col" style="max-width:100%;">
          <img class="rounded-circle" src="<%= contact.avatar %>" width="30"> 
          <%= contact.username %>
            </div>
            <div class="col frecon" style="max-width:100%;">
                <% contactMsgs = messages[Array(me.username, contact.username).sort().join('_')] %>
<% if (contactMsgs.length < 1) { %>
 No messages in here, but you can change that!
  <% } else { %>
<% if(contactMsgs[contactMsgs.length - 1].username == me.username) { %>
 You: <%= contactMsgs[contactMsgs.length - 1].content %>
<% } else { %>
  <%= contactMsgs[contactMsgs.length - 1].content %>
<% } %> 
  <% } %>
            </div>
          </div>
        </a>
      </li>
        <% }); %>
    </ul>
  </div>
    </div>
    
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
      </div>
  <script src="https://unpkg.com/swup@4"></script>
<script>
  const swup = new Swup({
  containers: ["#swup"]
});
  
  /* global bootstrap: false */
(() => {
  'use strict'
  const tooltipTriggerList = Array.from(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  tooltipTriggerList.forEach(tooltipTriggerEl => {
    new bootstrap.Tooltip(tooltipTriggerEl)
  })
})()

  function setElementDisplay() {
    const screenWidth = window.innerWidth;
    const onbElements = document.getElementsByClassName('onb');
    const snbElements = document.getElementsByClassName('snb');

    if (screenWidth < 950) {
      // Screen width is under 554px
      for (const onbElement of onbElements) {
        onbElement.classList.remove('d-flex');
        onbElement.classList.add('d-none');
      }

      for (const snbElement of snbElements) {
        snbElement.classList.remove('d-none');
        snbElement.classList.add('d-flex');
      }
    } else {
      // Screen width is over 554px
      for (const onbElement of onbElements) {
        onbElement.classList.remove('d-none');
        onbElement.classList.add('d-flex');
      }

      for (const snbElement of snbElements) {
        snbElement.classList.remove('d-flex');
        snbElement.classList.add('d-none');
      }
    }
  }

  // Run the function on initial load and whenever the window is resized
  window.addEventListener('load', setElementDisplay);
  window.addEventListener('resize', setElementDisplay);

  setInterval(setElementDisplay(), 0)
function addUser(me, user) {
  console.log(user)
  fetch('/user/' + me + '/addContact/' + user).then(res => res.json()).then(response => {
    if (response.error) {
      alert('something wen\'t wrong. try again later. REASON:' + response.error)
    } else {
      if (response.allGood == true) {
      window.location.assign('/messages/' + user)
      } else {
         alert('something wen\'t wrong. try again later. REASON:' + response.error)
      }
    }
  })
}

</script>
  </body>
</html>
            <% } %>